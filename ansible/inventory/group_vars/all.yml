---
# ===========================================
# VPS Setup - Global Variables
# ===========================================

# -------------------------------------------
# Versions
# -------------------------------------------
nodejs_version: "20"
php_version_default: "8.2"
nvm_version: "0.39.7"

# -------------------------------------------
# System Configuration
# -------------------------------------------
system_timezone: "Europe/Paris"
system_locale: "en_US.UTF-8"

# -------------------------------------------
# Common Packages
# -------------------------------------------
common_packages:
  - curl
  - wget
  - git
  - vim
  - htop
  - tmux
  - unzip
  - zip
  - acl
  - apt-transport-https
  - ca-certificates
  - gnupg
  - lsb-release
  - software-properties-common
  - rsync
  - jq
  - tree
  - ncdu

# -------------------------------------------
# PHP Configuration
# -------------------------------------------
php_modules:
  - "php{{ php_version }}-fpm"
  - "php{{ php_version }}-mysql"
  - "php{{ php_version }}-curl"
  - "php{{ php_version }}-gd"
  - "php{{ php_version }}-mbstring"
  - "php{{ php_version }}-xml"
  - "php{{ php_version }}-zip"
  - "php{{ php_version }}-intl"
  - "php{{ php_version }}-opcache"
  - "php{{ php_version }}-redis"
  - "php{{ php_version }}-bcmath"
  - "php{{ php_version }}-cli"

php_fpm_pool_user: www-data
php_fpm_pool_group: www-data
php_fpm_socket_path: "/run/php/php{{ php_version }}-fpm.sock"

# PHP OPcache settings
php_opcache_enable: 1
php_opcache_memory_consumption: 256
php_opcache_interned_strings_buffer: 16
php_opcache_max_accelerated_files: 10000
php_opcache_validate_timestamps: 0
php_opcache_revalidate_freq: 2
php_opcache_save_comments: 1

# -------------------------------------------
# UFW Configuration
# -------------------------------------------
ufw_allowed_ports:
  - 22    # SSH
  - 80    # HTTP
  - 443   # HTTPS

# -------------------------------------------
# fail2ban Configuration
# -------------------------------------------
fail2ban_ssh_maxretry: 3
fail2ban_ssh_bantime: 3600      # 1 hour
fail2ban_ssh_findtime: 600      # 10 minutes
fail2ban_ssh_port: ssh

# -------------------------------------------
# SSH Hardening
# -------------------------------------------
ssh_port: 22
ssh_permit_root_login: "no"
ssh_password_authentication: "no"
ssh_pubkey_authentication: "yes"
ssh_max_auth_tries: 3
ssh_max_sessions: 10
ssh_client_alive_interval: 300
ssh_client_alive_count_max: 2
ssh_x11_forwarding: "no"
ssh_allow_agent_forwarding: "yes"
ssh_allow_tcp_forwarding: "yes"

# -------------------------------------------
# Caddy Configuration
# -------------------------------------------
caddy_email: "admin@example.com"
caddy_sites:
  - name: "default"
    domains:
      - "{{ ansible_default_ipv4.address | default('localhost') }}"
    root: "/var/www/html"
    php: true
    encode: true
    log_file: "/var/log/caddy/default.log"
    php_max_execution_time: 60
    php_memory_limit: "256M"

# -------------------------------------------
# Runtime User (for NVM/Bun)
# -------------------------------------------
runtime_user: "{{ ansible_user | default('root') }}"

# -------------------------------------------
# Component Selection (defaults)
# -------------------------------------------
vps_components:
  docker: true
  php_fpm: false
  caddy: false
  nodejs: true
  nvm: false
  bun: true
  security: true
