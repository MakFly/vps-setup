---
# SSH Hardening Configuration

- name: Backup original sshd_config
  ansible.builtin.copy:
    src: /etc/ssh/sshd_config
    dest: /etc/ssh/sshd_config.backup
    remote_src: true
    mode: '0600'
  when: not ansible_check_mode

- name: Configure SSH daemon
  ansible.builtin.template:
    src: sshd_config.j2
    dest: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: '0644'
    validate: sshd -t -f %s
  notify: Restart SSH

- name: Ensure SSH service is enabled
  ansible.builtin.systemd:
    name: "{{ 'sshd' if ansible_distribution == 'Debian' else 'ssh' }}"
    enabled: true
